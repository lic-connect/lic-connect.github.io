<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIC Bima Ratna (Plan 764) Premium Calculator</title>
    <style>
        :root {
            --primary-color: #003366; /* LIC Blue */
            --secondary-color: #f0ad4e; /* LIC Yellow/Gold */
            --light-gray: #f4f4f4;
            --dark-gray: #333;
            --error-red: #d9534f;
            --success-green: #2b9348;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .calculator-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 700px;
            width: 100%;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.8em;
        }
        h1 + p {
            text-align: center;
            margin-top: 0;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--primary-color);
        }

        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
        }
        
        input[type="number"] {
           -moz-appearance: textfield;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
           -webkit-appearance: none;
            margin: 0;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
        }
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .sub-group {
            padding-left: 30px;
            margin-top: 10px;
            display: none; /* Hidden by default */
        }

        .btn-calculate {
            width: 100%;
            padding: 15px;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-calculate:hover {
            background-color: #e69524;
        }

        /* Styles for new buttons and result area */
        #standalone-actions {
            text-align: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .btn-know-more {
            background-color: #f7f7f7;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-know-more:hover {
            background-color: var(--primary-color);
            color: white;
        }

        #standalone-rider-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            display: none; /* Hidden by default */
        }
        #standalone-rider-result.success {
             background-color: #e7f3fe;
             border-left: 5px solid var(--success-green);
             color: var(--dark-gray);
        }
         #standalone-rider-result.error {
             background-color: #f2dede;
             border-left: 5px solid var(--error-red);
             color: #a94442;
        }


        #error-message {
            color: var(--error-red);
            font-weight: bold;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        #results {
            margin-top: 30px;
            display: none;
            border-top: 2px solid var(--primary-color);
            padding-top: 20px;
        }

        #results h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th, .results-table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .results-table th {
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9em;
        }

        .results-table tr:nth-child(even) {
            background-color: var(--light-gray);
        }

        .summary {
            background-color: #e7f3fe;
            border-left: 5px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .summary-item span:first-child { font-weight: bold; }

        .disclaimer {
            font-size: 0.8em;
            color: #777;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="calculator-container">
        <h1>LIC Bima Ratna</h1>
        <p>Plan No. 764 Premium Calculator</p>

        <form id="premium-form">
            <div class="form-group">
                <label for="age">Insured's Age (Years)</label>
                <input type="number" id="age" min="0" max="55" required>
            </div>
            <div class="form-group">
                <label for="sum-assured">Sum Assured (Minimum 5,00,000)</label>
                <input type="number" id="sum-assured" value="500000" min="500000" step="10000" required>
            </div>
            <div class="form-group">
                <label for="policy-term">Policy Term / Premium Paying Term (PPT)</label>
                <select id="policy-term" required>
                    <option value="15" data-ppt="11">15 Years / 11 Years</option>
                    <option value="20" data-ppt="16">20 Years / 16 Years</option>
                    <option value="25" data-ppt="21">25 Years / 21 Years</option>
                </select>
            </div>
            <hr>
            <p style="text-align:center; font-weight:bold; color: var(--primary-color);">Optional Riders</p>

            <div class="form-group checkbox-group">
                <input type="checkbox" id="addb-rider">
                <label for="addb-rider">Include Accidental Death & Disability Benefit (ADDB) Rider?</label>
            </div>

            <div class="form-group checkbox-group">
                <input type="checkbox" id="term-rider">
                <label for="term-rider">Include Term Assurance Rider? (Age 18+)</label>
            </div>
            
                        

            <div class="sub-group" id="term-rider-sa-group">
                <label for="term-rider-sum-assured">Term Rider Sum Assured (Max: Base Sum Assured)</label>
                <input type="number" id="term-rider-sum-assured" min="25000" step="10000">
            </div>
            <!-- END: New HTML Snippet -->

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="pwb-rider">
                    <label for="pwb-rider">Include Premium Waiver Benefit (PWB) Rider? (On Proposer)</label>
                </div>
                <div class="sub-group" id="proposer-age-group">
                    <label for="proposer-age">Proposer's Age (18-55)</label>
                    <input type="number" id="proposer-age" min="18" max="55">
                </div>
            </div>
            
            <button type="button" class="btn-calculate" id="calculate-btn">Calculate Premium</button>
        
             <!-- New Buttons and Result Area -->
            <div id="standalone-actions">
                <button type="button" class="btn-know-more" id="know-pwb-btn">Know Your PWB Premium</button>
                <button type="button" class="btn-know-more" id="know-term-rider-btn">Know Your Term Rider Premium</button>
            </div>
            <div id="standalone-rider-result"></div>

        </form>

        <div id="error-message"></div>
        
        <div id="results">
            <div class="summary" id="summary-details"></div>

            <div id="regular-premium-result">
                <h2>Mode-wise Final Premium (Including Riders & GST)</h2>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Mode</th>
                            <th>1st Year Premium (with 4.5% GST)</th>
                            <th>2nd Year Onwards Premium (with 2.25% GST)</th>
                        </tr>
                    </thead>
                    <tbody id="results-body">
                        <!-- Results will be populated here by JavaScript -->
                    </tbody>
                </table>
            </div>

            <p class="disclaimer">
                This is an illustrative calculation. Premiums are rounded to the nearest rupee. GST is calculated at 4.5% for the first year and 2.25% thereafter, as per current regulations for life insurance. Please contact an LIC agent for an official quote.
            </p>
        </div>
    </div>

    <script>
    // ####################################################################################
    // ## DATA CONSTANTS - DO NOT EDIT                                                   ##
    // ####################################################################################
    const regularPremiumRates = [
        {"Age":0,"T15":0,"T20":74.15,"T25":55.2},{"Age":1,"T15":0,"T20":74.15,"T25":55.2},{"Age":2,"T15":0,"T20":74.15,"T25":55.2},{"Age":3,"T15":0,"T20":74.15,"T25":55.2},{"Age":4,"T15":0,"T20":74.15,"T25":55.2},{"Age":5,"T15":107.75,"T20":74.15,"T25":55.25},{"Age":6,"T15":107.75,"T20":74.2,"T25":55.3},{"Age":7,"T15":107.85,"T20":74.3,"T25":55.4},{"Age":8,"T15":107.95,"T20":74.4,"T25":55.5},{"Age":9,"T15":108.05,"T20":74.5,"T25":55.6},{"Age":10,"T15":108.15,"T20":74.6,"T25":55.65},{"Age":11,"T15":108.2,"T20":74.65,"T25":55.75},{"Age":12,"T15":108.3,"T20":74.75,"T25":55.8},{"Age":13,"T15":108.4,"T20":74.8,"T25":55.9},{"Age":14,"T15":108.45,"T20":74.85,"T25":55.95},{"Age":15,"T15":108.5,"T20":74.9,"T25":56},{"Age":16,"T15":108.55,"T20":74.95,"T25":56.06},{"Age":17,"T15":108.6,"T20":75,"T25":56.1},{"Age":18,"T15":108.6,"T20":75,"T25":56.1},{"Age":19,"T15":108.6,"T20":75.05,"T25":56.15},{"Age":20,"T15":108.65,"T20":75.05,"T25":56.2},{"Age":21,"T15":108.65,"T20":75.1,"T25":56.25},{"Age":22,"T15":108.65,"T20":75.1,"T25":56.3},{"Age":23,"T15":108.7,"T20":75.15,"T25":56.35},{"Age":24,"T15":108.7,"T20":75.2,"T25":56.4},{"Age":25,"T15":108.75,"T20":75.25,"T25":56.5},{"Age":26,"T15":108.75,"T20":75.3,"T25":56.6},{"Age":27,"T15":108.8,"T20":75.4,"T25":56.7},{"Age":28,"T15":108.9,"T20":75.5,"T25":56.85},{"Age":29,"T15":108.95,"T20":75.6,"T25":57},{"Age":30,"T15":109.05,"T20":75.7,"T25":57.2},{"Age":31,"T15":109.15,"T20":75.85,"T25":57.4},{"Age":32,"T15":109.25,"T20":76.05,"T25":57.65},{"Age":33,"T15":109.4,"T20":76.25,"T25":57.9},{"Age":34,"T15":109.55,"T20":76.45,"T25":58.2},{"Age":35,"T15":109.75,"T20":76.7,"T25":58.55},{"Age":36,"T15":109.95,"T20":77,"T25":58.9},{"Age":37,"T15":110.15,"T20":77.3,"T25":59.3},{"Age":38,"T15":110.45,"T20":77.65,"T25":59.75},{"Age":39,"T15":110.75,"T20":78.05,"T25":60.25},{"Age":40,"T15":111.05,"T20":78.45,"T25":60.75},{"Age":41,"T15":111.45,"T20":78.95,"T25":61.35},{"Age":42,"T15":111.85,"T20":79.5,"T25":62},{"Age":43,"T15":112.35,"T20":80.05,"T25":62.7},{"Age":44,"T15":112.85,"T20":80.7,"T25":63.45},{"Age":45,"T15":113.45,"T20":81.4,"T25":64.3},{"Age":46,"T15":114.05,"T20":82.15,"T25":0},{"Age":47,"T15":114.75,"T20":83,"T25":0},{"Age":48,"T15":115.5,"T20":83.9,"T25":0},{"Age":49,"T15":116.3,"T20":84.85,"T25":0},{"Age":50,"T15":117.2,"T20":85.85,"T25":0},{"Age":51,"T15":118.1,"T20":0,"T25":0},{"Age":52,"T15":119.1,"T20":0,"T25":0},{"Age":53,"T15":120.1,"T20":0,"T25":0},{"Age":54,"T15":121.15,"T20":0,"T25":0},{"Age":55,"T15":122.3,"T20":0,"T25":0}
    ];

    const termRiderRates = [
        {"T15":2.04,"T20":1.92,"T25":1.93,"Term":18},{"T15":2.06,"T20":1.95,"T25":1.98,"Term":19},{"T15":2.08,"T20":1.99,"T25":2.04,"Term":20},{"T15":2.1,"T20":2.03,"T25":2.1,"Term":21},{"T15":2.13,"T20":2.08,"T25":2.18,"Term":22},{"T15":2.16,"T20":2.14,"T25":2.27,"Term":23},{"T15":2.2,"T20":2.21,"T25":2.37,"Term":24},{"T15":2.26,"T20":2.3,"T25":2.49,"Term":25},{"T15":2.32,"T20":2.4,"T25":2.63,"Term":26},{"T15":2.41,"T20":2.51,"T25":2.79,"Term":27},{"T15":2.51,"T20":2.65,"T25":2.98,"Term":28},{"T15":2.64,"T20":2.81,"T25":3.19,"Term":29},{"T15":2.78,"T20":3,"T25":3.44,"Term":30},{"T15":2.94,"T20":3.21,"T25":3.71,"Term":31},{"T15":3.13,"T20":3.46,"T25":4.01,"Term":32},{"T15":3.35,"T20":3.74,"T25":4.35,"Term":33},{"T15":3.6,"T20":4.06,"T25":4.72,"Term":34},{"T15":3.89,"T20":4.42,"T25":5.12,"Term":35},{"T15":4.22,"T20":4.82,"T25":5.56,"Term":36},{"T15":4.59,"T20":5.26,"T25":6.04,"Term":37},{"T15":5.02,"T20":5.74,"T25":6.55,"Term":38},{"T15":5.5,"T20":6.27,"T25":7.11,"Term":39},{"T15":6.04,"T20":6.85,"T25":7.72,"Term":40},{"T15":6.64,"T20":7.48,"T25":8.38,"Term":41},{"T15":7.28,"T20":8.15,"T25":9.08,"Term":42},{"T15":7.98,"T20":8.86,"T25":9.84,"Term":43},{"T15":8.74,"T20":9.64,"T25":10.66,"Term":44},{"T15":9.56,"T20":10.47,"T25":11.54,"Term":45},{"T15":10.45,"T20":11.37,"T25":null,"Term":46},{"T15":11.4,"T20":12.33,"T25":null,"Term":47},{"T15":12.41,"T20":13.36,"T25":null,"Term":48},{"T15":13.48,"T20":14.47,"T25":null,"Term":49},{"T15":14.62,"T20":15.65,"T25":null,"Term":50},{"T15":15.82,"T20":null,"T25":null,"Term":51},{"T15":17.08,"T20":null,"T25":null,"Term":52},{"T15":18.42,"T20":null,"T25":null,"Term":53},{"T15":19.83,"T20":null,"T25":null,"Term":54},{"T15":21.33,"T20":null,"T25":null,"Term":55}
    ];

    const pwbRiderRates = [
        {"A":1.7,"B":1.7,"C":1.85,"D":2.1,"E":2.45,"F":3.1,"G":4.1,"Term":5},{"A":1.8,"B":1.85,"C":1.95,"D":2.25,"E":2.7,"F":3.55,"G":4.8,"Term":6},{"A":1.9,"B":1.9,"C":2.1,"D":2.4,"E":2.95,"F":4,"G":5.55,"Term":7},{"A":1.95,"B":2,"C":2.2,"D":2.6,"E":3.25,"F":4.5,"G":6.3,"Term":8},{"A":2,"B":2.1,"C":2.3,"D":2.8,"E":3.6,"F":5,"G":7.05,"Term":9},{"A":2.2,"B":2.25,"C":2.55,"D":3.1,"E":4.05,"F":5.75,"G":8.15,"Term":10},{"A":2.25,"B":2.4,"C":2.65,"D":3.3,"E":4.4,"F":6.35,"G":9,"Term":11},{"A":2.3,"B":2.45,"C":2.8,"D":3.5,"E":4.8,"F":6.9,"G":9.85,"Term":12},{"A":2.45,"B":2.55,"C":2.95,"D":3.75,"E":5.15,"F":7.5,"G":10.7,"Term":13},{"A":2.5,"B":2.7,"C":3.1,"D":4,"E":5.55,"F":8.15,"G":11.6,"Term":14},{"A":2.6,"B":2.8,"C":3.3,"D":4.35,"E":6.1,"F":8.9,"G":12.75,"Term":15},{"A":2.7,"B":2.9,"C":3.5,"D":4.6,"E":6.5,"F":9.55,"G":13.7,"Term":16},{"A":2.8,"B":3.05,"C":3.65,"D":4.9,"E":7,"F":10.25,"G":14.7,"Term":17},{"A":2.85,"B":3.15,"C":3.85,"D":5.2,"E":7.45,"F":10.95,"G":15.75,"Term":18},{"A":2.9,"B":3.3,"C":4.05,"D":5.5,"E":7.95,"F":11.65,"G":16.8,"Term":19},{"A":3.05,"B":3.45,"C":4.25,"D":5.85,"E":8.4,"F":12.35,"G":0,"Term":20},{"A":3.1,"B":3.55,"C":4.45,"D":6.15,"E":8.95,"F":13.1,"G":0,"Term":21}
    ];

    // ####################################################################################
    // ## EVENT LISTENERS                                                                ##
    // ####################################################################################
    document.getElementById('calculate-btn').addEventListener('click', calculateRegularPremiums);
    document.getElementById('know-pwb-btn').addEventListener('click', calculateStandalonePwb);
    document.getElementById('know-term-rider-btn').addEventListener('click', calculateStandaloneTermRider);
        // START: New Event Listener Snippet
    document.getElementById('term-rider').addEventListener('change', function() {
        document.getElementById('term-rider-sa-group').style.display = this.checked ? 'block' : 'none';
    });
    // END: New Event Listener Snippet

    document.getElementById('pwb-rider').addEventListener('change', function() {
        document.getElementById('proposer-age-group').style.display = this.checked ? 'block' : 'none';
    });

    // ####################################################################################
    // ## HELPER & UTILITY FUNCTIONS                                                     ##
    // ####################################################################################

    function getRateByAge(age, term, rateArray, ageKey = 'Age', termKeyPrefix = 'T') {
        const row = rateArray.find(item => item[ageKey] === age);
        if (!row) return null;
        const rate = row[`${termKeyPrefix}${term}`];
        return (rate !== null && rate > 0) ? rate : null;
    }

    function getPwbRate(proposerAge, ppt, rateArray) {
        let ageBandCol;
        if (proposerAge >= 18 && proposerAge <= 25) ageBandCol = 'A';
        else if (proposerAge >= 26 && proposerAge <= 30) ageBandCol = 'B';
        else if (proposerAge >= 31 && proposerAge <= 35) ageBandCol = 'C';
        else if (proposerAge >= 36 && proposerAge <= 40) ageBandCol = 'D';
        else if (proposerAge >= 41 && proposerAge <= 45) ageBandCol = 'E';
        else if (proposerAge >= 46 && proposerAge <= 50) ageBandCol = 'F';
        else if (proposerAge >= 51 && proposerAge <= 55) ageBandCol = 'G';
        else return null;

        const row = rateArray.find(item => item.Term === ppt);
        if (!row) return null;
        const rate = row[ageBandCol];
        return (rate !== null && rate > 0) ? rate : null;
    }
    
    // Calculates the base policy premium before adding riders and modal factors.
    function getAnnualTabularPremium(age, sa, term) {
        const regularRate = getRateByAge(age, term, regularPremiumRates);
        if (!regularRate) {
            throw new Error(`Regular premium rate not available for Age ${age} and Term ${term}.`);
        }
        const basicAnnualPremium = (regularRate / 1000) * sa;
        
        let saRebateRate = 0;
        if (sa >= 25000000 && sa < 40000000) saRebateRate = 2.126;
        else if (sa >= 15000000 && sa < 25000000) saRebateRate = 1.913;
        else if (sa >= 1000000 && sa < 1500000) saRebateRate = 0.715;
        else if (sa >= 1500000 && sa < 2000000) saRebateRate = 1.020;
        else if (sa >= 2000000) saRebateRate = 1.276;
        const saRebateAmount = (saRebateRate / 1000) * sa;
        
        return basicAnnualPremium - saRebateAmount;
    }

    function hideAllResults() {
        document.getElementById('results').style.display = 'none';
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('standalone-rider-result').style.display = 'none';
    }

    function showStandaloneResult(message, isError = false) {
        hideAllResults();
        const resultDiv = document.getElementById('standalone-rider-result');
        resultDiv.textContent = message;
        resultDiv.className = isError ? 'error' : 'success';
        resultDiv.style.display = 'block';
    }
    
    function showError(message) {
        hideAllResults();
        const errorDiv = document.getElementById('error-message');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
    }
    
    // ####################################################################################
    // ## STANDALONE RIDER CALCULATIONS                                                  ##
    // ####################################################################################

        // START: Replace this function
    function calculateStandaloneTermRider() {
         try {
            const age = parseInt(document.getElementById('age').value, 10);
            const sa = parseInt(document.getElementById('sum-assured').value, 10);
            const term = parseInt(document.getElementById('policy-term').value, 10);
            const termRiderSA = parseInt(document.getElementById('term-rider-sum-assured').value, 10);


            if (isNaN(age) || isNaN(sa) || isNaN(term)) throw new Error("Please fill Age, Sum Assured and Term.");
            if (isNaN(termRiderSA) || termRiderSA <= 0) throw new Error("Please enter a valid Term Rider Sum Assured.");
            if (termRiderSA > sa) throw new Error("Term Rider Sum Assured cannot be more than the Base Sum Assured.");
            if (age < 18) throw new Error("Term Assurance Rider is only available for insured age 18 and above.");
            
            const termRiderRate = getRateByAge(age, term, termRiderRates, 'Term');
            if(!termRiderRate) throw new Error(`Term Rider rate not available for Age ${age} and Term ${term}.`);
            
            const termRiderAnnualPremium = (termRiderRate / 1000) * termRiderSA;
            
            showStandaloneResult(`Standalone Annual Term Rider Premium (Excl. GST) for SA of ₹${termRiderSA.toLocaleString('en-IN')}: ₹ ${Math.round(termRiderAnnualPremium).toLocaleString('en-IN')}`);

        } catch (e) {
            showStandaloneResult(e.message, true);
        }
    }
    // END: Replace this function
    
    function calculateStandalonePwb() {
        try {
            const age = parseInt(document.getElementById('age').value, 10);
            const sa = parseInt(document.getElementById('sum-assured').value, 10);
            const termElement = document.getElementById('policy-term');
            const term = parseInt(termElement.value, 10);
            const ppt = parseInt(termElement.options[termElement.selectedIndex].dataset.ppt, 10);
            const proposerAge = parseInt(document.getElementById('proposer-age').value, 10);
            
            if (isNaN(proposerAge) || proposerAge < 18 || proposerAge > 55) throw new Error("Please enter a valid Proposer Age between 18 and 55.");
            if (isNaN(age)) throw new Error("Please enter the Insured's Age.");
            if (proposerAge <= age) throw new Error("Proposer's age must be greater than the Insured's age.");

            const annualTabularPremium = getAnnualTabularPremium(age, sa, term);
            const pwbRate = getPwbRate(proposerAge, ppt, pwbRiderRates);
            if(!pwbRate) throw new Error(`PWB rate not available for Proposer Age ${proposerAge} and PPT ${ppt}.`);
            
            const pwbAnnualPremium = (pwbRate / 1000) * annualTabularPremium;

            showStandaloneResult(`Standalone Annual PWB Rider Premium (Excl. GST): ₹ ${Math.round(pwbAnnualPremium).toLocaleString('en-IN')}`);
            
        } catch (e) {
            showStandaloneResult(e.message, true);
        }
    }


    // ####################################################################################
    // ## MAIN PREMIUM CALCULATION LOGIC (UNCHANGED)                                     ##
    // ####################################################################################
        // START: Replace this function
    function calculateRegularPremiums() {
        hideAllResults(); // Clear any previous results first

        // --- 1. GET INPUTS & VALIDATE ---
        const age = parseInt(document.getElementById('age').value, 10);
        const sa = parseInt(document.getElementById('sum-assured').value, 10);
        const termElement = document.getElementById('policy-term');
        const term = parseInt(termElement.value, 10);
        const ppt = parseInt(termElement.options[termElement.selectedIndex].dataset.ppt, 10);
        const isAddb = document.getElementById('addb-rider').checked;
        const isTermRider = document.getElementById('term-rider').checked;
        const termRiderSA = parseInt(document.getElementById('term-rider-sum-assured').value, 10);
        const isPwbRider = document.getElementById('pwb-rider').checked;
        const proposerAge = parseInt(document.getElementById('proposer-age').value, 10);
        
        try {
            if (isNaN(age) || age < 0) throw new Error("Please enter a valid Insured's Age.");
            if (sa < 500000) throw new Error("Minimum Sum Assured is ₹5,00,000.");
            
            const minEntryAge = (term === 15) ? 5 : 0; 
            if (age < minEntryAge) throw new Error(`Minimum entry age for a ${term}-year term is ${minEntryAge === 0 ? '90 days' : minEntryAge + ' years'}.`);
            
            const maturityAge = age + term;
            if (maturityAge > 70) throw new Error(`Maximum maturity age is 70. Your combination results in a maturity age of ${maturityAge}.`);
            
            if (isTermRider) {
                if (age < 18) throw new Error("Term Assurance Rider is only available for insured age 18 and above.");
                if (isNaN(termRiderSA) || termRiderSA <= 0) throw new Error("Term Rider is checked. Please enter a valid Term Rider Sum Assured.");
                if (termRiderSA > sa) throw new Error("Term Rider Sum Assured cannot be more than the Base Sum Assured.");
            }
            
            if (isPwbRider) {
                if(isNaN(proposerAge) || proposerAge < 18 || proposerAge > 55) throw new Error("PWB Rider is checked. Please enter a valid Proposer Age between 18 and 55.");
                if (proposerAge <= age) throw new Error("PWB Rider is checked. Proposer's age must be greater than the Insured's age.");
            }
        
            // --- 2. PREMIUM & REBATE CALCULATION ---
            const annualTabularPremium = getAnnualTabularPremium(age, sa, term);
            
            // --- 3. CALCULATE RIDER PREMIUMS ---
            const addbAnnualPremium = isAddb ? (1.25 / 1000) * sa : 0;

            let termRiderAnnualPremium = 0;
            if (isTermRider) {
                const termRiderRate = getRateByAge(age, term, termRiderRates, 'Term');
                if(!termRiderRate) throw new Error(`Term Rider rate not available for Age ${age} and Term ${term}.`);
                termRiderAnnualPremium = (termRiderRate / 1000) * termRiderSA;
            }

            let pwbAnnualPremium = 0;
            if (isPwbRider) {
                const pwbRate = getPwbRate(proposerAge, ppt, pwbRiderRates);
                if(!pwbRate) throw new Error(`PWB rate not available for Proposer Age ${proposerAge} and PPT ${ppt}.`);
                pwbAnnualPremium = (pwbRate / 1000) * sa;
            }
        
            // --- 4. APPLY MODAL FACTORS AND TAX (Original Logic) ---
            const modalFactors = { yearly: 1.00, halfly: 0.4952, quarterly: 0.2501, monthly: 0.08337 };

            const totalRiderPremium = addbAnnualPremium + termRiderAnnualPremium + pwbAnnualPremium;
            const ylyBase = (annualTabularPremium * 0.98) + totalRiderPremium;
            const totalAnnualPremium = annualTabularPremium + totalRiderPremium;
            const hlyBase = totalAnnualPremium * modalFactors.halfly;
            const qlyBase = totalAnnualPremium * modalFactors.quarterly;
            const mlyBase = totalAnnualPremium * modalFactors.monthly;

            const regularPremiums = {};
            regularPremiums.yearly = { firstYear: Math.round(ylyBase * 1.045), secondYear: Math.round(ylyBase * 1.0225) };
            regularPremiums.halfly = { firstYear: Math.round(hlyBase * 1.045), secondYear: Math.round(hlyBase * 1.0225) };
            regularPremiums.quarterly = { firstYear: Math.round(qlyBase * 1.045), secondYear: Math.round(qlyBase * 1.0225) };
            regularPremiums.monthly = { firstYear: Math.round(mlyBase * 1.045), secondYear: Math.round(mlyBase * 1.0225) };
        
            // --- 5. DISPLAY ALL RESULTS ---
            const resultsDiv = document.getElementById('results');
            const summaryDiv = document.getElementById('summary-details');
            const resultsBody = document.getElementById('results-body');
            const summaryData = { age, sa, term, ppt, isAddb, isTermRider, termRiderSA, isPwbRider, proposerAge };

            summaryDiv.innerHTML = `
                <div class="summary-item"><span>Age:</span> <span>${summaryData.age} Years</span></div>
                <div class="summary-item"><span>Sum Assured:</span> <span>₹ ${summaryData.sa.toLocaleString('en-IN')}</span></div>
                <div class="summary-item"><span>Policy Term:</span> <span>${summaryData.term} Years</span></div>
                <div class="summary-item"><span>Premium Term (PPT):</span> <span>${summaryData.ppt} Years</span></div>
                <div class="summary-item"><span>ADDB Rider:</span> <span>${summaryData.isAddb ? 'Yes' : 'No'}</span></div>
                <div class="summary-item"><span>Term Rider:</span> <span>${summaryData.isTermRider ? 'Yes (SA: ₹' + summaryData.termRiderSA.toLocaleString('en-IN') + ')' : 'No'}</span></div>
                <div class="summary-item"><span>PWB Rider:</span> <span>${summaryData.isPwbRider ? 'Yes' + (summaryData.isPwbRider ? ` (Proposer Age: ${summaryData.proposerAge})` : '') : 'No'}</span></div>
            `;
            resultsBody.innerHTML = `
                <tr><td>Yearly</td><td>₹ ${regularPremiums.yearly.firstYear.toLocaleString('en-IN')}</td><td>₹ ${regularPremiums.yearly.secondYear.toLocaleString('en-IN')}</td></tr>
                <tr><td>Half-Yearly</td><td>₹ ${regularPremiums.halfly.firstYear.toLocaleString('en-IN')}</td><td>₹ ${regularPremiums.halfly.secondYear.toLocaleString('en-IN')}</td></tr>
                <tr><td>Quarterly</td><td>₹ ${regularPremiums.quarterly.firstYear.toLocaleString('en-IN')}</td><td>₹ ${regularPremiums.quarterly.secondYear.toLocaleString('en-IN')}</td></tr>
                <tr><td>Monthly (NACH)</td><td>₹ ${regularPremiums.monthly.firstYear.toLocaleString('en-IN')}</td><td>₹ ${regularPremiums.monthly.secondYear.toLocaleString('en-IN')}</td></tr>
            `;
            resultsDiv.style.display = 'block';

        } catch (e) {
            showError(e.message);
        }
    }
    // END: Replace this function
    </script>
</body>
</html>