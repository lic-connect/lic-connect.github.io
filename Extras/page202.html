<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIC Loan Form 5196 - Page 2</title>
    <style>
        body {
            font-family: 'Arial', 'Nirmala UI', 'Segoe UI', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .form-page {
            background-color: #fff;
            margin: 20px auto;
            padding: 30px;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 8.5in;
            min-height: 11in;
            box-sizing: border-box;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group input[readonly] {
            background-color: #e9e9e9;
        }
        .sup-button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            display: block;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .sup-button:hover {
            background-color: #0056b3;
        }
        .flex-container {
            display: flex;
            justify-content: space-between;
            gap: 20px; 
        }
        .flex-item {
            flex: 1; 
        }
        .section-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .note { 
            font-style: italic;
            font-size: 0.9em;
            color: #555;
        }
        .photo-placeholder { /* As per original file */
            width: 100px; 
            height: 120px; 
            border: 1px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px auto; 
            text-align: center;
            color: #aaa;
        }
        .small-print { /* As per original file */
            font-size: 0.8em;
            text-align: center;
            margin-top: 5px;
        }
        .signature-declaration { /* As per original file */
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .signature-block { /* As per original file */
            margin-top: 20px;
            border-top: 1px solid black;
            width: 250px; /* Adjust as needed */
            padding-top: 5px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="form-page">
        <!-- Content as per Google Drive page2.html, preserving all languages -->
        <p class="section-title">RECEIPT FOR LOAN <br> कर्जासाठी पावती <br> ऋण के लिए रसीद</p>
        <p>
            Received from the Life Insurance Corporation of India a sum of Rs. <input type="text" id="loanAmountReceived" name="loanAmountReceived" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            (Rupees <input type="text" id="loanAmountReceivedWords" name="loanAmountReceivedWords" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>)
            by way of loan on Policy No. <input type="text" id="policyNumberLoanReceipt" name="policyNumberLoanReceipt" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            on my life/ on the life of <input type="text" id="lifeOf" name="lifeOf" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>
        </p>
        <p>
            भारतीय आयुर्विमा महामंडळाकडून माझ्या पॉलिसी क्र. <input type="text" id="policyNumberLoanReceipt_mr" name="policyNumberLoanReceipt_mr" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            वर कर्जापोटी रु. <input type="text" id="loanAmountReceived_mr" name="loanAmountReceived_mr" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            (अक्षरी रुपये <input type="text" id="loanAmountReceivedWords_mr" name="loanAmountReceivedWords_mr" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>) मिळाले.
            माझ्या नावावर / <input type="text" id="lifeOf_mr" name="lifeOf_mr" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly> यांचे नावावर.
        </p>
        <p>
            भारतीय जीवन बीमा निगम से पॉलिसी क्र. <input type="text" id="policyNumberLoanReceipt_hi" name="policyNumberLoanReceipt_hi" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            पर ऋण स्वरूप रु. <input type="text" id="loanAmountReceived_hi" name="loanAmountReceived_hi" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            (रुपये शब्दों में <input type="text" id="loanAmountReceivedWords_hi" name="loanAmountReceivedWords_hi" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>) प्राप्त किये।
            मेरे जीवन पर / <input type="text" id="lifeOf_hi" name="lifeOf_hi" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly> के जीवन पर।
        </p>

        <div class="flex-container" style="margin-top:30px; align-items: flex-end;">
            <div class="flex-item">
                <div class="form-group">
                    <label for="dateReceipt">Date / तारीख / दिनांक:</label>
                    <input type="text" id="dateReceipt" name="dateReceipt" readonly>
                </div>
                <div style="margin-top: 40px;">
                    <div class="photo-placeholder">
                        Affix <br> Revenue <br> Stamp <br> Here
                    </div>
                    <p class="small-print">(Signature across the stamp) <br> (तिकिटावर सही करावी) <br> (टिकट पर हस्ताक्षर करें)</p>
                </div>
            </div>
            <div class="flex-item" style="text-align:right;">
                <div class="signature-block" style="margin-left:auto; margin-right:0;">
                    Signature of Policyholder/Assignee <br>
                    पॉलिसीधारकाची / समनुदेशकाची सही <br>
                    पॉलिसीधारक / अभिहस्तांकिती के हस्ताक्षर
                </div>
            </div>
        </div>

        <hr style="margin-top:30px; margin-bottom:30px;">

        <p class="section-title">ASSIGNMENT DECLARATION SLIP <br> समनुदेशन घोषणापत्र <br> अभिहस्तांकन घोषणा पर्ची</p>
        <p>(To be completed if the Policy is assigned) <br> (पॉलिसी समनुदेशित असल्यास भरावे) <br> (यदि पॉलिसी अभिहस्तांकित है तो इसे पूरा करें)</p>
        <p>
            I/We, <input type="text" id="assignorName" name="assignorName" style="width:calc(100% - 50px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>
            the Assignor(s) of Policy No. <input type="text" id="policyNumberAssignment" name="policyNumberAssignment" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            on the life of <input type="text" id="lifeOfAssignment" name="lifeOfAssignment" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>
            hereby declare that the above assignment is still in force.
        </p>
        <p>
            मी / आम्ही, <input type="text" id="assignorName_mr" name="assignorName_mr" style="width:calc(100% - 50px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>
            पॉलिसी क्र. <input type="text" id="policyNumberAssignment_mr" name="policyNumberAssignment_mr" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            चे समनुदेशक, याद्वारे घोषित करतो/करतो की वरील समनुदेशन अजूनही अंमलात आहे.
            आयुर्विम्यावर <input type="text" id="lifeOfAssignment_mr" name="lifeOfAssignment_mr" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>
        </p>
        <p>
            मैं / हम, <input type="text" id="assignorName_hi" name="assignorName_hi" style="width:calc(100% - 50px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>
            पॉलिसी क्र. <input type="text" id="policyNumberAssignment_hi" name="policyNumberAssignment_hi" style="width:150px; border:none; border-bottom:1px dotted #000; display:inline-block; text-align:center;" readonly>
            के अभिहस्तांकिती, एतद्द्वारा घोषित करता हूँ / करते हैं कि उपरोक्त अभिहस्तांकन अभी भी लागू है।
            के जीवन पर <input type="text" id="lifeOfAssignment_hi" name="lifeOfAssignment_hi" style="width:calc(100% - 170px); border:none; border-bottom:1px dotted #000; display:inline-block;" readonly>
        </p>

        <div class="flex-container" style="margin-top:30px; align-items: flex-end;">
            <div class="flex-item">
                <div class="form-group">
                    <label for="dateAssignment">Date / तारीख / दिनांक:</label>
                    <input type="text" id="dateAssignment" name="dateAssignment" readonly>
                </div>
            </div>
            <div class="flex-item" style="text-align:right;">
                 <div class="signature-block" style="margin-left:auto; margin-right:0;">
                    Signature of Assignor(s) <br>
                    समनुदेशकाची सही <br>
                    अभिहस्तांकिती के हस्ताक्षर
                </div>
            </div>
        </div>

        <div class="form-group" style="margin-top: 30px;">
            <label for="inputPolicyNumberPage2">Enter Policy Number to Load Details:</label>
            <input type="text" id="inputPolicyNumberPage2" placeholder="Enter Policy Number">
            <button class="sup-button" onclick="fetchPolicyDetailsForPage2()" style="display: block; margin-left:auto; margin-right:auto;">Load Page 2 Details</button>
        </div>

    </div>

   <script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const SUPABASE_URL = 'https://efduqdondmlzmwhfgkfz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmZHVxZG9uZG1sem13aGZna2Z6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4MDcxNjUsImV4cCI6MjA2NDM4MzE2NX0.M-D0eUjlCxc-vZtT3LdbWJJgLDZ-ScHQkZH69kU6d44';
        let supabase;

        try {
            supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log("Supabase client initialized successfully for Page 2.");
        } catch (e) {
            console.error("FATAL ERROR: Could not initialize Supabase client for Page 2!", e);
        }

        async function fetchPolicyDetailsForPage2() {
            if (!supabase) {
                console.error("Supabase client is not initialized. Cannot fetch Page 2 details.");
                return;
            }

            const policyNumberInput = document.getElementById('inputPolicyNumberPage2').value;
            if (!policyNumberInput) {
                console.warn('Policy number input for Page 2 is empty.');
                return;
            }
            console.log("Attempting to fetch Page 2 details for policy:", policyNumberInput);

            try {
                // Fields for Page 2 (Receipt and Assignment Declaration)
                // 'loan_amount' for loanAmountReceived
                // 'loan_amount_words' for loanAmountReceivedWords
                // 'policy_number' for policyNumberLoanReceipt and policyNumberAssignment
                // 'name' for lifeOf (assuming 'name' is the life assured's name)
                // 'today_date' for dateReceipt and dateAssignment (application date)
                // 'assignor_name' (if you have this field for assigned policies)
                const { data, error } = await supabase
                    .from('loan') 
                    .select('loan_amount, loan_amount_words, policy_number, name, today_date') // Add 'assignor_name' if available
                    .eq('policy_number', policyNumberInput)
                    .single();

                if (error) {
                    console.error("Supabase Error fetching Page 2 data:", JSON.stringify(error, null, 2));
                    clearPage2FormFields();
                    if (error.code === 'PGRST116') { 
                        console.warn('No details found for this policy number on Page 2.');
                    }
                    return;
                }

                if (data) {
                    console.log("Supabase Data Object for Page 2:", JSON.stringify(data, null, 2));
                    // Populate Receipt section (English)
                    document.getElementById('loanAmountReceived').value = data.loan_amount || '';
                    document.getElementById('loanAmountReceivedWords').value = data.loan_amount_words || '';
                    document.getElementById('policyNumberLoanReceipt').value = data.policy_number || '';
                    document.getElementById('lifeOf').value = data.name || ''; // Assuming 'name' is the life assured

                    // Populate Receipt section (Marathi) - using same data for now, adjust if you have specific Marathi fields in DB
                    document.getElementById('loanAmountReceived_mr').value = data.loan_amount || '';
                    document.getElementById('loanAmountReceivedWords_mr').value = data.loan_amount_words || ''; // You might need a Marathi words converter or field
                    document.getElementById('policyNumberLoanReceipt_mr').value = data.policy_number || '';
                    document.getElementById('lifeOf_mr').value = data.name || '';

                    // Populate Receipt section (Hindi) - using same data for now
                    document.getElementById('loanAmountReceived_hi').value = data.loan_amount || '';
                    document.getElementById('loanAmountReceivedWords_hi').value = data.loan_amount_words || ''; // You might need a Hindi words converter or field
                    document.getElementById('policyNumberLoanReceipt_hi').value = data.policy_number || '';
                    document.getElementById('lifeOf_hi').value = data.name || '';
                    
                    document.getElementById('dateReceipt').value = data.today_date || '';

                    // Populate Assignment Declaration section (English)
                    // Assuming 'assignorName' would come from a field like 'assignor_name' if policy is assigned
                    // For now, if policy is NOT assigned, these might be left blank or pre-filled with life assured's name as a placeholder if applicable
                    document.getElementById('assignorName').value = data.name || ''; // Placeholder: if not assigned, this might be policyholder. Adjust if you have 'assignor_name'
                    document.getElementById('policyNumberAssignment').value = data.policy_number || '';
                    document.getElementById('lifeOfAssignment').value = data.name || '';

                    // Populate Assignment Declaration (Marathi)
                    document.getElementById('assignorName_mr').value = data.name || '';
                    document.getElementById('policyNumberAssignment_mr').value = data.policy_number || '';
                    document.getElementById('lifeOfAssignment_mr').value = data.name || '';

                    // Populate Assignment Declaration (Hindi)
                    document.getElementById('assignorName_hi').value = data.name || '';
                    document.getElementById('policyNumberAssignment_hi').value = data.policy_number || '';
                    document.getElementById('lifeOfAssignment_hi').value = data.name || '';

                    document.getElementById('dateAssignment').value = data.today_date || '';

                } else {
                    console.warn('No data returned for Page 2 for policy:', policyNumberInput);
                    clearPage2FormFields();
                }
            } catch (e) {
                console.error("CRITICAL UNEXPECTED ERROR in fetchPolicyDetailsForPage2:", e);
                clearPage2FormFields();
            }
        }

        function clearPage2FormFields() {
            // Receipt
            document.getElementById('loanAmountReceived').value = '';
            document.getElementById('loanAmountReceivedWords').value = '';
            document.getElementById('policyNumberLoanReceipt').value = '';
            document.getElementById('lifeOf').value = '';
            document.getElementById('loanAmountReceived_mr').value = '';
            document.getElementById('loanAmountReceivedWords_mr').value = '';
            document.getElementById('policyNumberLoanReceipt_mr').value = '';
            document.getElementById('lifeOf_mr').value = '';
            document.getElementById('loanAmountReceived_hi').value = '';
            document.getElementById('loanAmountReceivedWords_hi').value = '';
            document.getElementById('policyNumberLoanReceipt_hi').value = '';
            document.getElementById('lifeOf_hi').value = '';
            document.getElementById('dateReceipt').value = '';
            // Assignment
            document.getElementById('assignorName').value = '';
            document.getElementById('policyNumberAssignment').value = '';
            document.getElementById('lifeOfAssignment').value = '';
            document.getElementById('assignorName_mr').value = '';
            document.getElementById('policyNumberAssignment_mr').value = '';
            document.getElementById('lifeOfAssignment_mr').value = '';
            document.getElementById('assignorName_hi').value = '';
            document.getElementById('policyNumberAssignment_hi').value = '';
            document.getElementById('lifeOfAssignment_hi').value = '';
            document.getElementById('dateAssignment').value = '';
        }

        window.fetchPolicyDetailsForPage2 = fetchPolicyDetailsForPage2;
        clearPage2FormFields(); // Clear fields on initial load

    </script>
</body>
</html>