<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LIC 20-Year Money Back Calculator (Plan 720)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f0f2f5; }
    .calculator-container { max-width: 700px; margin: 40px auto; padding: 30px; background: white; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
    h3 { color: #0c2f5a; }
    #results-summary { margin-top: 20px; padding: 15px; background: #f0f8ff; border: 1px solid #b0e0e6; border-radius: 5px; }
    #results-summary p { margin: 8px 0; font-size: 1.1em; display: flex; justify-content: space-between; }
    #results-summary p span:first-child { font-weight: bold; }
    hr { border: 0; border-top: 1px solid #ccc; margin: 20px 0; }
  </style>
</head>
<body>

<div class="calculator-container">
  <h3 class="text-center mb-4 fw-bold">LIC 20-Year Money Back (Plan 720)</h3>
  
  <div class="row g-3">
    <div class="col-md-6">
      <label for="age" class="form-label">Entry Age (13-50 Years)</label>
      <input type="number" class="form-control" id="age" value="30">
    </div>
    <div class="col-md-6">
      <label for="sumAssured" class="form-label">Sum Assured (₹)</label>
      <input type="number" class="form-control" id="sumAssured" value="500000" step="5000">
    </div>
    <div class="col-12">
      <label class="form-label">Policy Details</label>
      <input type="text" class="form-control" id="policyDetails" value="Term: 20 Years | PPT: 15 Years" readonly>
    </div>
    <!-- Rider Checkboxes -->
    <div class="col-md-6">
        <div class="form-check form-switch mt-2">
            <input class="form-check-input" type="checkbox" id="addADDB" checked>
            <label class="form-check-label" for="addADDB">Include ADDB Rider</label>
        </div>
    </div>
    <div class="col-md-6">
        <div class="form-check form-switch mt-2">
            <input class="form-check-input" type="checkbox" id="addTermRider">
            <label class="form-check-label" for="addTermRider">Include Term Rider</label>
        </div>
    </div>
  </div>

  <div id="error-message" class="text-danger fw-bold mt-3"></div>
  <button type="button" class="btn btn-success w-100 mt-4 py-2" onclick="calculate()">Calculate Premium</button>
  <div id="results" class="mt-4"></div>
</div>

<script>
// Data for Base Premium (Plan 720)
const baseRates = { 13: 80.75, 14: 80.85, 15: 80.9, 16: 80.95, 17: 81.0, 18: 81.0, 19: 81.05, 20: 81.1, 21: 81.15, 22: 81.2, 23: 81.25, 24: 81.3, 25: 81.4, 26: 81.5, 27: 81.6, 28: 81.75, 29: 81.9, 30: 82.05, 31: 82.3, 32: 82.55, 33: 82.8, 34: 83.15, 35: 83.5, 36: 83.9, 37: 84.35, 38: 84.8, 39: 85.35, 40: 85.95, 41: 86.55, 42: 87.25, 43: 88.0, 44: 88.85, 45: 89.75, 46: 90.7, 47: 91.7, 48: 92.85, 49: 94.0, 50: 95.3 };

// Data for Term Rider (Plan 720)
const termRiderRates = { 18: 2.0, 19: 2.04, 20: 2.07, 21: 2.11, 22: 2.17, 23: 2.23, 24: 2.31, 25: 2.39, 26: 2.5, 27: 2.62, 28: 2.76, 29: 2.93, 30: 3.13, 31: 3.35, 32: 3.61, 33: 3.9, 34: 4.23, 35: 4.6, 36: 5.02, 37: 5.47, 38: 5.98, 39: 6.53, 40: 7.14, 41: 7.79, 42: 8.48, 43: 9.22, 44: 10.02, 45: 10.89, 46: 11.81, 47: 12.81, 48: 13.88, 49: 15.02, 50: 16.24 };

const gstFirst = 1.045;
const gstSecond = 1.0225;

function calculate() {
  const sa = parseInt(document.getElementById("sumAssured").value);
  const age = parseInt(document.getElementById("age").value);
  const addADDB = document.getElementById("addADDB").checked;
  const addTermRider = document.getElementById("addTermRider").checked;
  
  const resultsDiv = document.getElementById("results");
  const errorDiv = document.getElementById("error-message");
  
  const term = 20; // This plan has a fixed term
  const ppt = 15;  // and a fixed PPT

  errorDiv.textContent = ""; // Clear previous errors
  document.getElementById("policyDetails").value = `Term: ${term} Years | PPT: ${ppt} Years`;

  // --- Validation ---
  if (age < 13 || age > 50) { errorDiv.textContent = "Entry Age must be between 13 and 50."; return; }
  if (sa < 200000) { errorDiv.textContent = "Minimum Sum Assured is ₹2,00,000."; return; }

  const baseRate = baseRates[age];
  if (!baseRate) {
    errorDiv.textContent = `Base premium rate not found for Age ${age}.`;
    return;
  }

  // --- STEP 1: Calculate Tabular Premiums ---
  let baseTabularPrem = (sa / 1000) * baseRate;
  let termRiderTabularPrem = 0;
  if (addTermRider) {
      if (age < 18) { errorDiv.textContent = "Term Rider is only available for age 18 and above."; return; }
      const riderRate = termRiderRates[age];
      if (!riderRate) { errorDiv.textContent = `Term Rider rate not found for Age ${age}.`; return; }
      termRiderTabularPrem = (sa / 1000) * riderRate;
  }

  // --- STEP 2: Conditional SA Rebate (The CRITICAL FIX) ---
  let saRebateRate = 0;
  if (addADDB) {
      // Rebate structure when ADDB is ON
      if (sa >= 500000) saRebateRate = 2.80;
  } else {
      // More generous, tiered rebate structure when ADDB is OFF
      if (sa >= 1000000) saRebateRate = 3.00;
      else if (sa >= 500000) saRebateRate = 3.0;
  }
  const saRebate = (sa / 1000) * saRebateRate;

  // --- STEP 3: Combine rebatable premiums and apply rebates ---
  let combinedRebatablePrem = baseTabularPrem + termRiderTabularPrem;
  const modeRebate = combinedRebatablePrem * 0.02; // 2% for Yearly mode, calculated on tabular premium
  let yearlyPremAfterRebates = combinedRebatablePrem - saRebate - modeRebate;

  // --- STEP 4: Conditional ADDB Premium Calculation ---
  let addbPrem = 0;
  if (addADDB) {
      if (age < 18) { errorDiv.textContent = "ADDB Rider is only available for age 18 and above."; return; }
      let addbRate = 1.0; // Default rate
      if (sa < 500000) {
          addbRate = 1.2; // Higher rate for smaller Sum Assured
      }
      addbPrem = (Math.min(sa, 10000000) / 1000) * addbRate;
  }
  
  // --- STEP 5: Final Taxable Premium ---
  const netAnnual = yearlyPremAfterRebates + addbPrem;

  // --- STEP 6: Calculate Final Modal Premiums with GST ---
  const modalFactors = { yly: 1, hly: 0.500, qly: 0.2500, mly: 0.0833 };
  const finalPremiums = {};
  for (let mode in modalFactors) {
    let modeRebatePercent = 0;
    if (mode === 'yly') modeRebatePercent = 0.02;
    if (mode === 'hly') modeRebatePercent = 0.01;

    const modeRebateAmount = combinedRebatablePrem * modeRebatePercent;
    const totalRebatableForMode = combinedRebatablePrem - saRebate - modeRebateAmount;
    
    const totalTaxableForMode = totalRebatableForMode + addbPrem;
    const modalPremium = totalTaxableForMode * modalFactors[mode];
    
    finalPremiums[mode] = {
      first: "₹" + Math.round(modalPremium * gstFirst).toLocaleString("en-IN"),
      second: "₹" + Math.round(modalPremium * gstSecond).toLocaleString("en-IN")
    };
  }

  // --- STEP 7: Display the breakdown and results ---
  resultsDiv.innerHTML = `
    <hr>
    <div id="results-summary">
      <h4 class="text-center">Premium Breakdown (Yearly)</h4>
      <p><span>Base + Term Rider (Tabular):</span> <span>${"₹" + Math.round(combinedRebatablePrem).toLocaleString("en-IN")}</span></p>
      <p><span>Less SA Rebate (Rate: ${saRebateRate.toFixed(2)}):</span> <span>- ₹${Math.round(saRebate).toLocaleString("en-IN")}</span></p>
      <p><span>Less Mode Rebate:</span> <span>- ₹${Math.round(modeRebate).toLocaleString("en-IN")}</span></p>
      <p><span>ADDB Rider Premium:</span> <span>+ ₹${Math.round(addbPrem).toLocaleString("en-IN")}</span></p>
      <hr class="my-2">
      <p><span>Total Annual Premium (before GST):</span> <span>${"₹" + Math.round(netAnnual).toLocaleString("en-IN")}</span></p>
    </div>
    <h4 class="text-center mt-3">Final Premiums (Including GST)</h4>
    <table class="table table-striped table-bordered mt-2">
      <thead class="table-light">
        <tr><th>Mode</th><th>1st Year Premium</th><th>2nd Year Onwards</th></tr>
      </thead>
      <tbody>
        <tr><td>Yearly</td><td>${finalPremiums.yly.first}</td><td>${finalPremiums.yly.second}</td></tr>
        <tr><td>Half-Yearly</td><td>${finalPremiums.hly.first}</td><td>${finalPremiums.hly.second}</td></tr>
        <tr><td>Quarterly</td><td>${finalPremiums.qly.first}</td><td>${finalPremiums.qly.second}</td></tr>
        <tr><td>Monthly</td><td>${finalPremiums.mly.first}</td><td>${finalPremiums.mly.second}</td></tr>
      </tbody>
    </table>`;
}
</script>

</body>
</html>